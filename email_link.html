<!DOCTYPE html>
<html>
<head>
  <title>Complete Sign In</title>
</head>
<body>
  <h2>Completing Sign In...</h2>

  <script type="module">
    import { auth } from "./firebase.js";
    import { isSignInWithEmailLink, signInWithEmailLink } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    // Check if this URL is a sign-in link
    if (isSignInWithEmailLink(auth, window.location.href)) {
      let email = window.localStorage.getItem("emailForSignIn");

      // If no email stored, ask the user
      if (!email) {
        email = window.prompt("Please provide your email for confirmation");
      }

      signInWithEmailLink(auth, email, window.location.href)
        .then((result) => {
          window.localStorage.removeItem("emailForSignIn");
          alert("Sign-in successful! ðŸŽ‰");

          // Redirect to your dashboard after login
          window.location.href = "/dashboard";
        })
        .catch((error) => {
          console.error(error);
          alert("Error: " + error.message);
        });
    } else {
      alert("Invalid or expired link.");
    }
  </script>
</body>
</html>
